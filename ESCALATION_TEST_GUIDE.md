# ๐งช ุฏููู ุงุฎุชุจุงุฑ ูุธุงู ุงูุชุตุนูุฏ ุงูููุตุญุญ

## โ **ุงูุฅุตูุงุญ ุงูููุทุจู:**
- **ุงููุดููุฉ:** ูุงู ุงููุธุงู ูุจุญุซ ูู ุฌุฏูู `whatsapp_messages` ุบูุฑ ุงูููุฌูุฏ
- **ุงูุญู:** ุงูุขู ูุจุญุซ ูู `whatsapp_ai_interactions` (ุงูุฌุฏูู ุงูุตุญูุญ)
- **ุงูุซูุฉ:** ุชููุฑุฃ ูู `metadata.intent_confidence` ุจุฏูุงู ูู ุญูู ุบูุฑ ููุฌูุฏ

## ๐งช **ููููุฉ ุงุฎุชุจุงุฑ "Attempts Before Escalation":**

### **ุงูุฅุนุฏุงุฏ ููุงุฎุชุจุงุฑ:**

1. **ุงุถุจุท ุงูุนุชุจุฉ ุนูู 2** (ุจุฏูุงู ูู 3) ูุงุฎุชุจุงุฑ ุฃุณุฑุน:
   ```
   Attempts Before Escalation: 2
   ```

2. **ุชุฃูุฏ ูู ุชูุนูู ุงููุธุงู:**
   ```
   Enable Escalation System: โ ูููุนู
   ```

### **ุณููุงุฑูู ุงูุงุฎุชุจุงุฑ:**

#### **ุงูุฎุทูุฉ 1: ุฃุฑุณู ุฑุณุงุฆู ุบุงูุถุฉ ูุฎูุถ ุงูุซูุฉ**
```
ุฑุณุงูุฉ 1: "ูุง ูุฐุงุ"
ุฑุณุงูุฉ 2: "ูุง ุฃููู ุดูุฆุงู"
ุฑุณุงูุฉ 3: "ุฃุฑูุฏ ุดูุฆุงู ูุง"
```

#### **ุงูุฎุทูุฉ 2: ุฑุงูุจ ุงูุณููู ุงููุชููุน**
- **ุจุนุฏ ุงูุฑุณุงูุฉ ุงูุฃููู:** AI ูุญุงูู ุงูุฑุฏ (ุซูุฉ ููุฎูุถุฉ)
- **ุจุนุฏ ุงูุฑุณุงูุฉ ุงูุซุงููุฉ:** AI ูุญุงูู ูุฑุฉ ุฃุฎุฑู (ุซูุฉ ููุฎูุถุฉ)
- **ุจุนุฏ ุงูุฑุณุงูุฉ ุงูุซุงูุซุฉ:** **ุชุตุนูุฏ ุชููุงุฆู** ๐จ

#### **ุงูุฎุทูุฉ 3: ุชุญูู ูู ุงูุชุตุนูุฏ**
- **ุฑุณุงูุฉ ุงูุชุตุนูุฏ:** ุณุชุตู ููุนููู
- **ุชูุจูู ูุฑูู ุงูุฏุนู:** ุณูุฑุณู ูุฌููุน ุงูุฃุฑูุงู ุงููููุนูุฉ
- **ุณุฌู ุงูุชุตุนูุฏ:** ุณูุธูุฑ ูู "Escalated Conversations"

## ๐ **ูุฑุงูุจุฉ ุงูุจูุงูุงุช:**

### **ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**

```sql
-- ูุญุต ุงูุชูุงุนูุงุช ุงูุฃุฎูุฑุฉ ูุงูุซูุฉ
SELECT 
  user_phone,
  user_message,
  metadata->>'intent_confidence' as confidence,
  created_at
FROM whatsapp_ai_interactions 
WHERE whatsapp_instance_id = 'YOUR_INSTANCE_ID'
  AND user_phone = 'CUSTOMER_PHONE'
ORDER BY created_at DESC 
LIMIT 5;

-- ูุญุต ุงูุชุตุนูุฏุงุช
SELECT *
FROM escalated_conversations
WHERE whatsapp_number = 'CUSTOMER_PHONE'
ORDER BY escalated_at DESC;
```

### **ูู Logs:**
ุงุจุญุซ ุนู ูุฐู ุงูุฑุณุงุฆู:
```
"Escalation needed: Low confidence threshold exceeded"
"lowConfidenceCount: X, threshold: Y"
```

## ๐ฏ **ุงุฎุชุจุงุฑุงุช ุฅุถุงููุฉ:**

### **ุงุฎุชุจุงุฑ ุงููููุงุช ุงูููุชุงุญูุฉ (ูุฌุจ ุฃู ุชุนูู ููุง ูู):**
```
"ุฃุฑูุฏ ุงูุชุญุฏุซ ูุน ููุธู"
"human support"
"customer service"
```
**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ุชุตุนูุฏ ููุฑู (ุจุฏูู ูุญุงููุงุช)

### **ุงุฎุชุจุงุฑ ุงูููุงุถูุน ุงูุญุณุงุณุฉ:**
```
"ูุฏู ุดููู"
"ุฃุฑูุฏ ุงุณุชุฑุฏุงุฏ ุงูุฃููุงู"
"complaint"
```
**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ุชุตุนูุฏ ููุฑู

## ๐ง **ุงุณุชูุดุงู ุงูุฃุฎุทุงุก:**

### **ุฅุฐุง ูู ูุนูู ุงูุชุตุนูุฏ:**

1. **ุชุญูู ูู ุชูุนูู ุงููุธุงู:**
   - `escalation_enabled = true`

2. **ุชุญูู ูู ูุฌูุฏ ุฑูู ุฏุนู ูููุนู:**
   - ุนูู ุงูุฃูู ุฑูู ูุงุญุฏ ูู "Support Team Numbers"
   - ุงูุฑูู ูุฌุจ ุฃู ูููู `is_active = true`

3. **ุชุญูู ูู ุงูุนุชุจุฉ:**
   - `escalation_threshold` ููุทููุฉ (2-5)

4. **ุฑุงุฌุน Logs:**
   - ุงุจุญุซ ุนู "Low confidence threshold exceeded"
   - ุชุญูู ูู ููู confidence ูู interactions

## ๐ **ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุณุงุจูุฉ (ุฅุฐุง ูุฒู ุงูุฃูุฑ):**

```bash
# ุงุณุชุนุงุฏุฉ webhook
cp /path/to/whatsapp-webhook/index.ts.backup /path/to/whatsapp-webhook/index.ts

# ุงุณุชุนุงุฏุฉ process-buffered-messages  
cp /path/to/process-buffered-messages/index.ts.backup /path/to/process-buffered-messages/index.ts
```

---

**ููุงุญุธุฉ:** ุงูุฅุตูุงุญ ูุง ูุคุซุฑ ุฅูุง ุนูู "Attempts Before Escalation". ุจุงูู ุฃููุงุน ุงูุชุตุนูุฏ ุชุนูู ุจุดูู ุทุจูุนู.